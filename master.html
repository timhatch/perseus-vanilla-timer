<!DOCTYPE html>
<head>
  <meta charset='utf-8'>
  <title>Rotation Timers</title>
  <link href='./content.css' rel='stylesheet' type='text/css'>
</head>
<body>
  <div class="flex container">
    <div class="flex row">
      <div id='4m15' class="button">4m15 rotation</div>
      <div id='5m00' class="button">5m00 rotation</div>
      <div id='5m15' class="button">5m15 rotation</div>
    </div>
    <div class="flex timer" id='inner'></div>
    <div class="flex timer" id='outer'></div>
  </div>
  <script type="module">
    import {fullScreen, onResize} from "./display-utils.js"
    import {clockTime}            from "./timer-views.js"
    import RotationTimer          from './timer-rotation.js'

    // Create a global clock instance
    var clock  = null
    var sub    = new WebSocket(`ws://${window.location.hostname}/sub`)
    var el     = document.getElementById('inner')

    // Initialise the clock only where it doesn't already exist 
    // and indicate the selection
    // sig: (HTMLElement el, Integer climbing, Integer interval) -> void
    function handler(event, climbing, interval) {
      const el = event.target.id
      if (!clock) {
        document.getElementById(el).style.color = '#ff000066'
        clock = new RotationTimer({climbing, interval})
      }
    }

    sub.onmessage = clockTime(el)

    // The main event loop
    document.addEventListener('DOMContentLoaded', function(){
      document.getElementById('4m15').addEventListener('click', (e) => handler(e, 240,15))
      document.getElementById('5m00').addEventListener('click', (e) => handler(e, 300,0))
      document.getElementById('5m15').addEventListener('click', (e) => handler(e, 300,15))
    }, false)
  </script>
</body>

