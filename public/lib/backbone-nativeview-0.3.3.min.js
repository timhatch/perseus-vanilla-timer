(function(factory){if(typeof define==="function"&&define.amd){define(["backbone"],factory)}else if(typeof module==="object"){module.exports=factory(require("backbone"))}else{factory(Backbone)}})(function(Backbone){var paddedLt=/^\s*</;var ElementProto=typeof Element!=="undefined"&&Element.prototype||{};var elementAddEventListener=ElementProto.addEventListener?function(eventName,listener){return this.addEventListener(eventName,listener,false)}:function(eventName,listener){return this.attachEvent("on"+eventName,listener)};var elementRemoveEventListener=ElementProto.removeEventListener?function(eventName,listener){return this.removeEventListener(eventName,listener,false)}:function(eventName,listener){return this.detachEvent("on"+eventName,listener)};var indexOf=function(array,item){for(var i=0,len=array.length;i<len;i++)if(array[i]===item)return i;return-1};var matchesSelector=ElementProto.matches||ElementProto.webkitMatchesSelector||ElementProto.mozMatchesSelector||ElementProto.msMatchesSelector||ElementProto.oMatchesSelector||function(selector){var nodeList=(this.parentNode||document).querySelectorAll(selector)||[];return~indexOf(nodeList,this)};var BBView=Backbone.View;Backbone.NativeViewMixin={_domEvents:null,constructor:function(){this._domEvents=[];return BBView.apply(this,arguments)},$:function(selector){return this.el.querySelectorAll(selector)},_removeElement:function(){this.undelegateEvents();if(this.el.parentNode)this.el.parentNode.removeChild(this.el)},_setElement:function(element){if(typeof element=="string"){if(paddedLt.test(element)){var el=document.createElement("div");el.innerHTML=element;this.el=el.firstChild}else{this.el=document.querySelector(element)}}else if(element&&element.length){this.el=element[0]}else{this.el=element}},_setAttributes:function(attrs){for(var attr in attrs){attr in this.el?this.el[attr]=attrs[attr]:this.el.setAttribute(attr,attrs[attr])}},delegate:function(eventName,selector,listener){if(typeof selector==="function"){listener=selector;selector=null}var root=this.el;var handler=selector?function(e){var node=e.target||e.srcElement;for(;node&&node!=root;node=node.parentNode){if(matchesSelector.call(node,selector)){e.delegateTarget=node;listener(e)}}}:listener;elementAddEventListener.call(this.el,eventName,handler,false);this._domEvents.push({eventName:eventName,handler:handler,listener:listener,selector:selector});return handler},undelegate:function(eventName,selector,listener){if(typeof selector==="function"){listener=selector;selector=null}if(this.el){var handlers=this._domEvents.slice();var i=handlers.length;while(i--){var item=handlers[i];var match=item.eventName===eventName&&(listener?item.listener===listener:true)&&(selector?item.selector===selector:true);if(!match)continue;elementRemoveEventListener.call(this.el,item.eventName,item.handler,false);this._domEvents.splice(i,1)}}return this},undelegateEvents:function(){if(this.el){for(var i=0,len=this._domEvents.length;i<len;i++){var item=this._domEvents[i];elementRemoveEventListener.call(this.el,item.eventName,item.handler,false)}this._domEvents.length=0}return this}};Backbone.NativeView=Backbone.View.extend(Backbone.NativeViewMixin);return Backbone.NativeView});